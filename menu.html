<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo</title>
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="menu.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <button class="hamburger" id="mobile-menu-btn" aria-label="Abrir menú">
                    <i class='bx bx-menu'></i>
                </button>
                <h1 class="header-title" data-i18n="admin_panel_title">Panel Administrativo</h1>
            </div>
            
            <div class="header-right">
                <div class="language-toggle">
                    <label class="toggle-container">
                        <span class="toggle-label">ES</span>
                        <input type="checkbox" id="language-toggle">
                        <span class="slider"></span>
                        <span class="toggle-label">EN</span>
                    </label>
                </div>
                <button class="logout-btn" data-i18n="logout">
                    <i class='bx bx-log-out'></i>
                    <span>Salir</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-content">
            <nav class="nav">
                <button class="nav-btn" data-section="accesos">
                    <i class='bx bx-history'></i>
                    <span data-i18n="access_history">Historial de Accesos</span>
                </button>
                
                <button class="nav-btn" data-section="empleados">
                    <i class='bx bx-group'></i>
                    <span data-i18n="employee_management">Gestión de Empleados</span>
                </button>
                
                <button class="nav-btn" data-section="autorizaciones">
                    <i class='bx bx-check-shield'></i>
                    <span data-i18n="authorizations">Autorizaciones</span>
                </button>
                
                <button class="nav-btn" data-section="estadisticas">
                    <i class='bx bx-bar-chart-alt-2'></i>
                    <span data-i18n="statistics">Estadísticas</span>
                </button>
            </nav>
        </div>
    </aside>

    <!-- Mobile Sidebar -->
    <div class="mobile-sidebar-overlay" id="mobile-sidebar-overlay"></div>

    <!-- CONTENIDO MAIN -->
    <main class="main-content">
        <!-- Historial de Accesos  -->
        <section id="accesos" class="content-section active">
            <div class="section-header">
                <h2 data-i18n="access_history_title">Historial de Ingresos/Egresos</h2>
                <div class="section-actions">
                    <button id="refresh-records-btn" class="btn btn-secondary">
                        <i class='bx bx-refresh'></i>
                        <span data-i18n="refresh_records">Actualizar Registros</span>
                    </button>
                </div>
            </div>

            <!-- TARJETAS DE ESTADISTICAS -->
            <div class="stats-grid">
                <div class="stat-card inside">
                    <div class="stat-icon">
                        <i class='bx bx-user-check'></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="people-inside-count">0</h3>
                        <p data-i18n="inside">Dentro</p>
                    </div>
                </div>
                
                <div class="stat-card outside">
                    <div class="stat-icon">
                        <i class='bx bx-user-x'></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="people-outside-count">0</h3>
                        <p data-i18n="outside">Fuera</p>
                    </div>
                </div>
            </div>

            <!-- FILTROS -->
            <div class="filters-card">
                <h3>Filtros</h3>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="filter-by-name">Nombre</label>
                        <input type="text" id="filter-by-name" placeholder="Filtrar por nombre...">
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-by-id">Legajo</label>
                        <input type="text" id="filter-by-id" placeholder="Filtrar por legajo...">
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-by-shift">Turno</label>
                        <select id="filter-by-shift">
                            <option value="">Todos los turnos</option>
                            <option value="Mañana">Mañana</option>
                            <option value="Tarde">Tarde</option>
                            <option value="Noche">Noche</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-by-type">Tipo</label>
                        <select id="filter-by-type">
                            <option value="">Todos los tipos</option>
                            <option value="ingreso">Ingreso</option>
                            <option value="egreso">Egreso</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-by-date">Fecha</label>
                        <input type="date" id="filter-by-date">
                    </div>
                    
                    <div class="filter-group">
                        <button id="clear-filters-btn" class="btn btn-outline">
                            <i class='bx bx-x'></i>
                            Limpiar Filtros
                        </button>
                    </div>
                </div>
            </div>

            <!-- TABLA DE ACCESOS -->
            <div class="table-card">
                <div class="table-container">
                    <table class="records-table">
                        <thead>
                            <tr>
                                <th data-i18n="date">Fecha</th>
                                <th data-i18n="employee">Empleado/a</th>
                                <th data-i18n="code">Legajo</th>
                                <th data-i18n="type">Tipo</th>
                                <th data-i18n="status">Estado</th>
                            </tr>
                        </thead>
                        <tbody id="records-tbody">
                            <!-- Los accesos se cargan aqui -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- EMPLEADOS -->
        <section id="empleados" class="content-section">
            <div id="empleados-main-view">
                <div class="section-header">
                    <h2 data-i18n="employee_management">Gestión de Empleados</h2>
                    <div class="section-actions">
                        <button id="btn-nuevo-empleado" class="btn btn-primary">
                            <i class='bx bx-user-plus'></i>
                            <span data-i18n="register_new_employee">Registrar Nuevo Empleado</span>
                        </button>
                        <button id="btn-carga-manual" class="btn btn-secondary">
                            <i class='bx bx-edit'></i>
                            <span>Carga de Ingreso/Egreso Manual</span>
                        </button>
                    </div>
                </div>

                <!-- FILTROS DE EMPANADAS -->
                <div class="filters-card">
                    <h3>Filtros de Empleados</h3>
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label for="filter-employee-by-role">Rol</label>
                            <select id="filter-employee-by-role">
                                <option value="">Todos los roles</option>
                                <option value="Operario">Operario</option>
                                <option value="Analista">Analista</option>
                                <option value="Supervisor">Supervisor</option>
                                <option value="Gerente">Gerente</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="filter-employee-by-shift">Turno</label>
                            <select id="filter-employee-by-shift">
                                <option value="">Todos los turnos</option>
                                <option value="Mañana">Mañana</option>
                                <option value="Tarde">Tarde</option>
                                <option value="Noche">Noche</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="filter-employee-by-menu-access">Acceso al Menú</label>
                            <select id="filter-employee-by-menu-access">
                                <option value="">Todos los niveles</option>
                                <option value="true">Con Acceso al Menú (Nivel 3+)</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <button id="clear-employee-filters-btn" class="btn btn-outline">
                                <i class='bx bx-x'></i>
                                Limpiar Filtros
                            </button>
                        </div>
                    </div>
                </div>

                <!-- LISTA DE EMPLEADOS -->
                <div class="employees-grid" id="empleados-list">
                    <!-- Los empleados se cargan aquí -->
                </div>
            </div>

            <!-- REGISTRO DE EMPLEADO -->
            <div id="register-screen" class="register-screen">
                <div class="form-card">
                    <div class="form-header">
                        <h2 data-i18n="new_user_registration_title">Registro de Nuevo Usuario</h2>
                        <button id="back-to-employees" class="btn btn-outline">
                            <i class='bx bx-arrow-back'></i>
                            <span data-i18n="back">Volver</span>
                        </button>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="operator-code" data-i18n="employee_code_label">Legajo:</label>
                            <input type="text" id="operator-code" required>
                        </div>

                        <div class="form-group">
                            <label for="operator-name" data-i18n="name_label">Nombre:</label>
                            <input type="text" id="operator-name" required>
                        </div>

                        <div class="form-group">
                            <label for="operator-surname" data-i18n="surname_label">Apellido:</label>
                            <input type="text" id="operator-surname" required>
                        </div>

                        <div class="form-group">
                            <label for="operator-dni">DNI:</label>
                            <input type="text" id="operator-dni" required>
                        </div>

                        <div class="form-group">
                            <label for="operator-email">Email:</label>
                            <input type="email" id="operator-email" required>
                        </div>

                        <div class="form-group">
                            <label for="operator-role" data-i18n="role_label">Rol:</label>
                            <select id="operator-role" required>
                                <option value="" data-i18n="select_role">Seleccione un rol...</option>
                                <option value="1">Operario (Nivel 1)</option>
                                <option value="2">Analista (Nivel 2)</option>
                                <option value="3">Supervisor (Nivel 3)</option>
                                <option value="4">Gerente (Nivel 4)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="operator-zone" data-i18n="zone_label">Zona Asignada:</label>
                            <select id="operator-zone" multiple required>
                                <option value="Recepcion">Recepción</option>
                                <option value="Almacenamiento">Almacenamiento</option>
                                <option value="Procesamiento">Procesamiento</option>
                                <option value="Conservacion">Conservación</option>
                                <option value="Despacho">Despacho</option>
                            </select>
                            <small>Mantén presionado Ctrl (o Cmd en Mac) para seleccionar múltiples zonas.</small>
                        </div>

                        <div class="form-group">
                            <label for="operator-shift" data-i18n="shift_label">Turno:</label>
                            <select id="operator-shift" required>
                                <option value="" data-i18n="select_shift">Seleccione un turno...</option>
                                <option value="Mañana">Mañana</option>
                                <option value="Tarde">Tarde</option>
                                <option value="Noche">Noche</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button id="capture-btn" class="btn btn-primary">
                            <i class='bx bx-camera'></i>
                            <span data-i18n="capture_face">Capturar Rostro</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- CAPTURA DE CARA -->
            <div id="capture-screen" class="capture-screen">
                <div class="capture-card">
                    <div class="capture-header">
                        <h2 data-i18n="face_capture_title">Captura de Rostro</h2>
                        <p data-i18n="face_capture_instruction">Por favor, colóquese frente a la cámara y asegúrese de que su rostro esté bien iluminado.</p>
                    </div>

                    <div class="video-container">
                        <video id="video" autoplay muted></video>
                        <canvas id="overlay"></canvas>
                        <div class="video-frame"></div>
                    </div>

                    <div class="capture-status">
                        <p id="capture-status" class="status info" data-i18n="waiting_for_detection">Esperando detección facial...</p>
                    </div>

                    <div class="capture-actions">
                        <button id="back-to-register" class="btn btn-outline">
                            <i class='bx bx-arrow-back'></i>
                            <span data-i18n="back_to_register">Volver al Registro</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- AUTORIZACIONES -->
        <section id="autorizaciones" class="content-section">
            <div class="section-header">
                <h2 data-i18n="pending_authorizations_title">Autorizaciones Pendientes</h2>
                <div class="section-actions">
                    <button id="refresh-authorizations-btn" class="btn btn-secondary">
                        <i class='bx bx-refresh'></i>
                        <span data-i18n="refresh_authorizations">Actualizar</span>
                    </button>
                </div>
            </div>

            <div id="authorizations-list" class="authorizations-list">
                <!-- Las autorizaciones se cargan aqui -->
            </div>
        </section>

        <!-- ESTADISTICAS -->
        <section id="estadisticas" class="content-section">
            <div class="section-header">
                <h2 data-i18n="statistics">Estadísticas</h2>
            </div>

            <div class="stats-controls">
                <button class="stage-btn active" data-stage="Indicadores">
                    <i class='bx bx-trending-up'></i>
                    <span data-i18n="indicators">Indicadores</span>
                </button>
                <button class="stage-btn" data-stage="Accesos">
                    <i class='bx bx-time'></i>
                    <span data-i18n="stats_access_analysis">Análisis de Accesos</span>
                </button>
                <button class="stage-btn" data-stage="Recepcion">
                    <i class='bx bx-package'></i>
                    <span data-i18n="stats_reception">Recepción</span>
                </button>
                <button class="stage-btn" data-stage="Almacenamiento">
                    <i class='bx bx-store'></i>
                    <span data-i18n="stats_storage">Almacenamiento</span>
                </button>
                <button class="stage-btn" data-stage="Procesamiento">
                    <i class='bx bx-cog'></i>
                    <span data-i18n="stats_processing">Procesamiento</span>
                </button>
                <button class="stage-btn" data-stage="Conservacion">
                    <i class='bx bx-refrigerator'></i>
                    <span data-i18n="stats_conservation">Conservación</span>
                </button>
                <button class="stage-btn" data-stage="ServicioDespacho">
                    <i class='bx bx-truck'></i>
                    <span data-i18n="stats_dispatch">Despacho</span>
                </button>
            </div>

            <div id="indicators-view">
                <div class="oee-components-grid">
                    <div class="chart-card">
                        <h3>Disponibilidad</h3>
                        <canvas id="availabilityChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Rendimiento</h3>
                        <canvas id="performanceChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Calidad</h3>
                        <canvas id="qualityChart"></canvas>
                    </div>
                </div>
                <div class="chart-container main-chart">
                    <h3>Tendencia OEE General</h3>
                    <canvas id="oeeTrendChart"></canvas>
                </div>
            </div>
            <div id="stages-view" class="stages-view" style="display: none;">
                <div class="stage-charts-grid" id="recepcion-charts">
                    <div class="chart-card"><canvas id="recepcionChart1"></canvas></div>
                    <div class="chart-card"><canvas id="recepcionChart2"></canvas></div>
                    <div class="chart-card"><canvas id="recepcionChart3"></canvas></div>
                </div>
                <div class="stage-charts-grid" id="almacenamiento-charts">
                    <div class="chart-card"><canvas id="almacenamientoChart1"></canvas></div>
                    <div class="chart-card"><canvas id="almacenamientoChart2"></canvas></div>
                    <div class="chart-card"><canvas id="almacenamientoChart3"></canvas></div>
                </div>
                <div class="stage-charts-grid" id="procesamiento-charts">
                    <div class="chart-card"><canvas id="procesamientoChart1"></canvas></div>
                    <div class="chart-card"><canvas id="procesamientoChart2"></canvas></div>
                    <div class="chart-card"><canvas id="procesamientoChart3"></canvas></div>
                </div>
                <div class="stage-charts-grid" id="conservacion-charts">
                    <div class="chart-card"><canvas id="conservacionChart1"></canvas></div>
                    <div class="chart-card"><canvas id="conservacionChart2"></canvas></div>
                    <div class="chart-card"><canvas id="conservacionChart3"></canvas></div>
                </div>
                <div class="stage-charts-grid" id="despacho-charts">
                    <div class="chart-card"><canvas id="despachoChart1"></canvas></div>
                    <div class="chart-card"><canvas id="despachoChart2"></canvas></div>
                    <div class="chart-card"><canvas id="despachoChart3"></canvas></div>
                </div>
            </div>
            <div id="access-charts-view" style="display: none;">
                <div class="oee-components-grid">
                    <div class="chart-card">
                        <h3>Llegadas</h3>
                        <canvas id="arrivalsChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Empleados por Turno</h3>
                        <canvas id="shiftChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Empleados por Rol</h3>
                        <canvas id="roleChart"></canvas>
                    </div>
                </div>
            </div>
            <div id="statsFallback" class="chart-fallback" data-i18n="stats_chart_fallback">Gráfico de estadísticas se mostraría aquí</div>

            <div id="insights-container" class="insights-container">
                <h3 data-i18n="key_alerts_observations">Alertas y Observaciones Clave</h3>
                <div id="insights-list" class="insights-list">
                    <!-- Los indicadores se cargan aqui -->
                </div>
            </div>

            <div id="alerts-config-container" class="filters-card">
                <h3>Configuración de Alertas</h3>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="rejection-threshold">Umbral de Rechazo de Materia Prima (%)</label>
                        <input type="number" id="rejection-threshold" value="20" min="0" max="100">
                    </div>
                    <div class="filter-group">
                        <label for="waste-threshold">Umbral de Desperdicio en Procesamiento (%)</label>
                        <input type="number" id="waste-threshold" value="25" min="0" max="100">
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/face-api.js/dist/face-api.min.js"></script>
    <script type="module" src="js/menu.js"></script>
</body>

</html>