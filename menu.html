<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Administrativo</title>
  <link rel="manifest" href="manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="menu.css">

  <!-- Librer√≠as necesarias -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

  <script type="module" src="js/i18n-logic.js"></script>
  <script type="module" src="js/menu.js"></script>
</head>

<body>
  <header class="admin-header">
    <div class="header-inner">
      <h1 class="panel-title" data-i18n="admin_panel_title">Panel Administrativo</h1>

      <div class="header-controls">
        <div class="language-switcher">
          <span class="lang-es">ESP</span>
          <label class="switch">
            <input type="checkbox" id="language-toggle">
            <span class="slider round"></span>
          </label>
          <span class="lang-en">ENG</span>
        </div>
        <button class="logout-btn" data-i18n="logout">Salir</button>
      </div>

      <!-- üëá Bot√≥n hamburguesa y sidebar van aqu√≠ dentro -->
      <button id="mobile-menu-btn" class="hamburger" data-i18n="open_menu" aria-label="Abrir men√∫ lateral" aria-expanded="false"
        aria-controls="mobile-sidebar">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>

      <!-- Sidebar m√≥vil -->
      <aside id="mobile-sidebar" class="mobile-sidebar" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="mobile-sidebar-header">
          <strong data-i18n="menu">Men√∫</strong>
          <button id="mobile-sidebar-close" data-i18n="close_menu" aria-label="Cerrar men√∫">‚úï</button>
        </div>
        <nav class="mobile-sidebar-nav" role="navigation" aria-label="Navegaci√≥n m√≥vil">
          <button class="mobile-side-item" data-section="accesos" data-i18n="access_history">Historial de Accesos</button>
          <button class="mobile-side-item" data-section="empleados" data-i18n="employee_management">Gesti√≥n de Empleados</button>
          <button class="mobile-side-item" data-section="autorizaciones" data-i18n="authorizations">Autorizaciones</button>
          <button class="mobile-side-item" data-section="estadisticas" data-i18n="statistics">Estad√≠sticas</button>
        </nav>
        <div class="mobile-sidebar-footer">
          <button class="btn btn-secondary" onclick="logout()" data-i18n="logout">Salir</button>
        </div>
      </aside>

      <!-- Overlay -->
      <div id="mobile-sidebar-overlay" class="mobile-sidebar-overlay" aria-hidden="true"></div>
    </div>

    <!-- navegaci√≥n principal (se oculta en mobile por CSS) -->
    <nav class="admin-nav" role="navigation" aria-label="Panel principal">
      <button class="nav-btn active" data-section="accesos" aria-controls="accesos" data-i18n="access_history">Historial de Accesos</button>
      <button class="nav-btn" data-section="empleados" aria-controls="empleados" data-i18n="employee_management">Gesti√≥n de Empleados</button>
      <button class="nav-btn" data-section="autorizaciones" aria-controls="autorizaciones" data-i18n="authorizations">Autorizaciones</button>
      <button class="nav-btn" data-section="estadisticas" aria-controls="estadisticas" data-i18n="statistics">Estad√≠sticas</button>
    </nav>
  </header>

  <main class="container">

    <!-- ACCESOS -->
    <section id="accesos" class="content-section">
      <h2 data-i18n="access_history_title">Historial de Ingresos/Egresos</h2>
      <button id="refresh-records" class="btn btn-primary" data-i18n="refresh_records">Actualizar Registros</button>

      <div class="filter-container">
        <input type="text" id="filter-by-name" placeholder="Filtrar por nombre..." data-i18n-placeholder="filter_by_name_placeholder">
        <input type="text" id="filter-by-id" placeholder="Filtrar por legajo..." data-i18n-placeholder="filter_by_id_placeholder">
        <select id="filter-by-shift">
          <option value="" data-i18n="all_shifts">Todos los turnos</option>
          <option value="Ma√±ana" data-i18n="shift_morning">Ma√±ana</option>
          <option value="Tarde" data-i18n="shift_afternoon">Tarde</option>
          <option value="Noche" data-i18n="shift_night">Noche</option>
        </select>
        <select id="filter-by-type">
          <option value="" data-i18n="all_types">Todos los tipos</option>
          <option value="ingreso" data-i18n="entry_type">Ingreso</option>
          <option value="egreso" data-i18n="exit_type">Egreso</option>
        </select>
        <input type="date" id="filter-by-date">
        <button id="clear-filters-btn" class="btn btn-secondary" data-i18n="clear_filters">Limpiar Filtros</button>
      </div>

      <div class="records-summary">
        <div class="summary-card">
          <h3 data-i18n="inside">Dentro</h3>
          <span id="people-inside-count">0</span>
        </div>
        <div class="summary-card">
          <h3 data-i18n="outside">Fuera</h3>
          <span id="people-outside-count">0</span>
        </div>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th data-i18n="date">Fecha</th>
              <th data-i18n="employee">Empleado/a</th>
              <th data-i18n="code">Legajo</th>
              <th data-i18n="type">Tipo</th>
              <th data-i18n="status">Estado</th>
            </tr>
          </thead>
          <tbody id="records-tbody"></tbody> <!-- Registros se cargan aca -->
        </table>
      </div>
    </section>

    <!-- EMPLEADOS -->
    <section id="empleados" class="content-section">
      <div id="empleados-main-view">
        <h2 data-i18n="employee_management">Gesti√≥n de Empleados</h2>
        <button id="btn-nuevo-empleado" class="btn btn-primary" data-i18n="register_new_employee">Registrar Nuevo Empleado</button>
        <button id="btn-eliminar-empleado" class="btn btn-danger" data-i18n="delete_employee">Eliminar Empleado</button>

        <div class="filter-container">
          <select id="filter-employee-by-role">
            <option value="" data-i18n="all_roles">Todos los roles</option>
            <option value="Empleado" data-i18n="role_employee_label">Empleado</option>
            <option value="Analista" data-i18n="role_analyst">Analista</option>
            <option value="Supervisor" data-i18n="role_supervisor_label">Supervisor</option>
            <option value="Gerente" data-i18n="role_manager">Gerente</option>
          </select>
          <select id="filter-employee-by-shift">
            <option value="" data-i18n="all_shifts">Todos los turnos</option>
            <option value="Ma√±ana" data-i18n="shift_morning">Ma√±ana</option>
            <option value="Tarde" data-i18n="shift_afternoon">Tarde</option>
            <option value="Noche" data-i18n="shift_night">Noche</option>
          </select>
          <select id="filter-employee-by-menu-access">
            <option value="" data-i18n="all_access_levels">Todos los accesos</option>
            <option value="true" data-i18n="with_menu_access">Con Acceso al Men√∫ (Nivel 3+)</option>
          </select>
          <button id="clear-employee-filters-btn" class="btn btn-secondary" data-i18n="clear_filters">Limpiar Filtros</button>
        </div>

        <div id="empleados-list"></div> <!-- Lista de empleados se carga aca -->
      </div>

      <!-- Pantalla de registro -->
      <div id="register-screen" class="screen">
        <h2 data-i18n="new_user_registration_title">Registro de Nuevo Usuario</h2>
        <div class="form-group">
          <label for="operator-code" data-i18n="employee_code_label">Legajo:</label>
          <input type="text" id="operator-code" placeholder="Ej: OP-001">
        </div>
        <div class="form-group">
          <label for="operator-name" data-i18n="name_label">Nombre:</label>
          <input type="text" id="operator-name" placeholder="Ej: Ana">
        </div>
        <div class="form-group">
          <label for="operator-surname" data-i18n="surname_label">Apellido:</label>
          <input type="text" id="operator-surname" placeholder="Ej: Perez">
        </div>
        <div class="form-group">
          <label for="operator-dni" data-i18n="operator_dni_label">DNI:</label>
          <input type="text" id="operator-dni" placeholder="Ej: 12345678">
        </div>
        <div class="form-group">
          <label for="operator-role" data-i18n="role_label">Rol:</label>
          <select id="operator-role">
            <option value="" data-i18n="select_role">Seleccione un rol...</option>
            <option value="1" data-i18n="role_employee">Empleado (Nivel 1)</option>
            <option value="2" data-i18n="role_analyst">Analista (Nivel 2)</option>
            <option value="3" data-i18n="role_supervisor">Supervisor (Nivel 3)</option>
            <option value="4" data-i18n="role_manager">Gerente (Nivel 4)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="operator-zone" data-i18n="zone_label">Zona Asignada:</label>
          <select id="operator-zone" multiple>
            <option value="Recepci√≥n" data-i18n="zone_reception">Recepci√≥n</option>
            <option value="Almacenamiento" data-i18n="zone_storage">Almacenamiento</option>
            <option value="Procesamiento" data-i18n="zone_processing">Procesamiento</option>
            <option value="Conservaci√≥n" data-i18n="zone_conservation">Conservaci√≥n</option>
            <option value="Despacho" data-i18n="zone_dispatch">Despacho</option>
          </select>
          <small class="form-hint" data-i18n="multi_select_hint">Mant√©n presionado Ctrl (o Cmd en Mac) para seleccionar varias zonas.</small>
        </div>

        <div class="form-group">
          <label for="operator-shift" data-i18n="shift_label">Turno:</label>
          <select id="operator-shift">
            <option value="" data-i18n="select_shift">Seleccione un turno...</option>
            <option value="Ma√±ana" data-i18n="shift_morning">Ma√±ana</option>
            <option value="Tarde" data-i18n="shift_afternoon">Tarde</option>
            <option value="Noche" data-i18n="shift_night">Noche</option>
          </select>
        </div>

        <div class="action-buttons">
          <button id="capture-btn" class="btn btn-primary" data-i18n="capture_face">Capturar Rostro</button>
          <button id="back-to-employees" class="btn btn-secondary" data-i18n="back">Volver</button>
        </div>
      </div>

      <!-- Pantalla de captura facial -->
      <div id="capture-screen" class="screen">
        <h2 data-i18n="face_capture_title">Captura de Rostro</h2>
        <p data-i18n="face_capture_instruction">Por favor, col√≥quese frente a la c√°mara y aseg√∫rese de que su rostro est√© bien iluminado.</p>
        <div class="video-container">
          <video id="video" width="600" height="450" autoplay muted></video>
          <canvas id="overlay"></canvas>
        </div>
        <div id="capture-status" class="status info" data-i18n="waiting_for_detection">Esperando detecci√≥n facial...</div>
        <div class="action-buttons">
          <button id="confirm-capture-btn" class="btn btn-primary" disabled data-i18n="confirm_capture">Confirmar Captura</button>
          <button id="retry-capture-btn" class="btn btn-secondary" data-i18n="retry">Reintentar</button>
          <button id="back-to-register" class="btn btn-secondary" data-i18n="back_to_register">Volver al Registro</button>
        </div>
      </div>
    </section>

    <!-- AUTORIZACIONES -->
    <section id="autorizaciones" class="content-section">
      <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h2 data-i18n="pending_authorizations_title" style="margin: 0;">Autorizaciones Pendientes</h2>
        <button id="refresh-authorizations-btn" class="btn btn-primary" data-i18n="refresh_authorizations">Actualizar</button>
      </div>
      <div id="authorizations-list" class="authorizations-container">
        <!-- Las tarjetas de autorizaci√≥n se cargar√°n aqu√≠ -->
      </div>
    </section>

    <!-- ESTADISTICAS -->
    <section id="estadisticas" class="content-section" hidden>
      <h2 data-i18n="statistics">Estad√≠sticas</h2>

      <!-- botones por etapa -->
      <div class="stage-buttons" role="tablist" aria-label="Etapas de proceso">
        <button class="stage-btn active" data-stage="Recepcion" role="tab" data-i18n="zone_reception">Recepci√≥n</button>
        <button class="stage-btn" data-stage="Almacenamiento" role="tab" data-i18n="zone_storage">Almacenamiento</button>
        <button class="stage-btn" data-stage="Procesamiento" role="tab" data-i18n="zone_processing">Procesamiento</button>
        <button class="stage-btn" data-stage="Conservacion" role="tab" data-i18n="zone_conservation">Conservaci√≥n</button>
        <button class="stage-btn" data-stage="ServicioDespacho" role="tab" data-i18n="zone_dispatch">Servicio y Despacho</button>
        <button class="stage-btn" data-stage="Indicadores" role="tab" data-i18n="statistics">Indicadores</button>
      </div>

      <!-- Contenedor para insights -->
      <div id="insights-container" class="insights-wrapper" style="display: none;">
        <h3 data-i18n="key_alerts_observations">Alertas y Observaciones Clave</h3>
        <div id="insights-list"></div>
      </div>

      <!-- contenedor del gr√°fico -->
      <div class="chart-wrapper">
        <canvas id="statsCanvas" aria-label="Gr√°fico de estad√≠sticas" role="img"></canvas>
        <div id="statsFallback" class="fallback" data-i18n="stats_chart_fallback">Gr√°fico de estad√≠sticas se mostrar√≠a aqu√≠</div>
      </div>
    </section>

  </main>

  <footer class="app-footer">
    <small data-i18n="footer_text">¬© Sistema - Panel Administrativo</small>
  </footer>
</body>

</html>